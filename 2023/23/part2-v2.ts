let input: string;

input = `
#.###########################################################################################################################################
#...#...#...###...###...#...#...#...#...###...#...#####.....#.............#.....#...#...###.......#...#.....#####...#...#####...#...###...###
###.#.#.#.#.###.#.###.#.#.#.#.#.#.#.#.#.###.#.#.#.#####.###.#.###########.#.###.#.#.#.#.###.#####.#.#.#.###.#####.#.#.#.#####.#.#.#.###.#.###
###.#.#.#.#...#.#...#.#.#.#.#.#.#.#.#.#.#...#...#.###...#...#.....#.......#...#...#.#.#.#...#.....#.#.#...#.#.....#...#.......#...#.#...#...#
###.#.#v#.###.#.###.#.#.#.#.#.#.#.#.#.#.#.#######.###.###.#######.#.#########.#####.#.#.#.###.#####.#.###.#.#.#####################.#.#####.#
###...#.>.#...#.#...#.#.#.#.#.#.#.#.#.#.#.......#...#...#.>.>.###.#.#...#...#.#.....#.#.#...#.#####.#.#...#.#...#...#...#.........#.#.#.....#
#######v###.###.#.###.#.#.#.#.#.#.#.#.#.#######.###.###.###v#.###.#.#.#.#.#.#.#.#####.#.###.#.#####.#.#.###.###.#.#.#.#.#.#######.#.#.#.#####
#...#...###.....#...#.#.#.#.#.#.#.#.#.#.#.....#...#.#...#...#.....#...#.#.#.#.#.#.....#.>.>.#...#...#.#...#.....#.#...#...#.....#...#.#.#...#
#.#.#.#############.#.#.#.#.#.#.#.#.#.#.#.###.###.#.#.###.#############.#.#.#.#.#.#######v#####.#.###.###.#######.#########.###.#####.#.#.#.#
#.#...#...###.......#.#.#.#.#.#.#.#.#.#.#...#.#...#...###...#...#...#...#.#...#...###...#.###...#...#.###.......#.#...#...#.#...#...#.#.#.#.#
#.#####.#.###.#######.#.#.#.#.#.#.#.#.#.###.#.#.###########.#.#.#.#.#.###.###########.#.#.###.#####.#.#########.#.#.#.#.#.#.#.###.#.#.#.#.#.#
#...#...#...#.#.....#.#.#.#.#.#.#.#.#.#.#...#.#...........#.#.#...#.#...#.#.........#.#.#...#.#...#.#...#...>.>.#...#...#.#.#...#.#.#.#.#.#.#
###.#.#####.#.#.###.#.#.#.#.#.#.#.#.#.#.#.###.###########.#.#.#####.###.#.#.#######.#.#.###.#.#.#.#.###.#.###v###########.#.###.#.#.#.#.#.#.#
###.#.#.....#.#.#...#.#.#.#.#.#.#.#.#.#.#...#.#...#.....#.#.#.#.....###...#.......#.#.#.#...#.#.#.#...#...#...#.........#.#.#...#.#.#.#.#.#.#
###.#.#.#####.#.#.###.#.#.#.#.#.#.#.#.#.###.#.#.#.#.###.#.#.#.#.#################.#.#.#.#.###.#.#.###.#####.###.#######.#.#.#.###.#.#.#.#.#.#
###...#.....#.#.#...#.#...#.#.#.#.#.#.#.>.>.#.#.#.#...#...#...#...........#.......#...#...#...#.#.#...#...#...#...#...#...#.#.#...#.#.#.#.#.#
###########.#.#.###.#.#####.#.#.#.#.#.###v###.#.#.###.###################.#.###############.###.#.#.###.#.###.###.#.#.#####.#.#.###.#.#.#.#.#
#...........#...#...#.....#.#.#...#...#...###.#.#.#...#...................#.............#...#...#.#...#.#.....###.#.#.....#.#.#.#...#.#...#.#
#.###############.#######.#.#.#########.#####.#.#.#.###.###############################.#.###.###.###.#.#########.#.#####.#.#.#.#.###.#####.#
#...............#...#...#.#...###...#...#...#...#...###...................#.............#.....###.....#.........#.#...#...#.#.#.#...#.#.....#
###############.###.#.#.#.#######.#.#.###.#.#############################.#.###################################.#.###.#.###.#.#.###.#.#.#####
#...............#...#.#...###.....#...###.#.###...#####...#...........#...#.#.......#...#.......###...#...#...#.#.#...#...#.#.#.#...#.#.....#
#.###############.###.#######.###########.#.###.#.#####.#.#.#########.#.###.#.#####.#.#.#.#####.###.#.#.#.#.#.#.#.#.#####.#.#.#.#.###.#####.#
#.......#.......#...#...#.....#.......###.#.#...#...#...#.#.........#...###...#.....#.#.#.....#.#...#.#.#...#...#...#.....#.#.#.#...#.#.....#
#######.#.#####.###.###.#.#####.#####.###.#.#.#####.#.###.#########.###########.#####.#.#####.#.#.###.#.#############.#####.#.#.###.#.#.#####
#.......#.#.....###.#...#...#...#.....#...#.#.....#.#.#...#####...#.......#...#.....#.#.#...#.#.#.#...#.........#...#...#...#...###...#.....#
#.#######.#.#######.#.#####.#.###.#####.###.#####.#.#.#.#######.#.#######.#.#.#####.#.#.#.#.#.#.#.#.###########.#.#.###.#.#################.#
#.#...#...#...#...#...#...#...#...###...#...#.....#.#.#.....#...#.........#.#.###...#.#.#.#.#.#.#.#.#...###.....#.#.###...###.........###...#
#.#.#.#.#####v#.#.#####.#.#####.#####.###.###.#####.#.#####.#.#############.#.###.###.#.#.#.#.#.#.#.#.#.###v#####.#.#########.#######.###.###
#...#.#.#...#.>.#...#...#.#...#.....#.#...###.....#...#.....#...#.........#.#.#...###.#.#.#.#.#.#.#...#...>.>.###.#.#...#...#.......#.....###
#####.#.#.#.#v#####.#.###.#.#.#####.#.#.#########.#####.#######.#.#######.#.#.#.#####.#.#.#.#.#.#.#########v#.###.#.#.#.#.#.#######.#########
#...#...#.#...#.....#...#.#.#.......#.#.#...#...#...#...###...#.#.#.......#.#.#...#...#...#.#.#...#.........#...#.#.#.#.#.#.#...###.........#
#.#.#####.#####.#######.#.#.#########.#.#.#.#.#.###.#.#####.#.#v#.#.#######.#.###.#.#######.#.#####.###########.#.#.#.#.#.#.#.#.###########.#
#.#.......#...#...#####.#.#.......#...#.#.#.#.#...#.#...#...#.>.>.#...#...#.#.###.#.......#.#...###...#.......#.#.#.#.#.#.#...#...#.........#
#.#########.#.###.#####.#.#######v#.###.#.#.#.###.#.###.#.#####v#####.#.#.#.#.###v#######.#.###.#####.#.#####.#.#.#.#.#.#.#######.#.#########
#.#.......#.#...#...#...#.......>.>.###...#...#...#...#...###...#...#...#.#.#...>.>.......#...#.#...#...#...#.#.#.#.#.#...#.......#.........#
#.#.#####.#.###.###.#.###########v#############.#####.#######.###.#.#####.#.#####v###########.#.#.#.#####.#.#.#.#.#.#.#####.###############.#
#...#...#.#.#...###...#...........###.......###.#.....#.......###.#.......#...###.........###...#.#.......#.#.#.#.#...#.....#...#...........#
#####.#.#.#.#.#########.#############.#####.###.#.#####.#########.###########.###########.#######.#########.#.#.#.#####.#####.#.#.###########
#...#.#.#...#.......###...............#.....#...#.#...#.........#.....#...#...#...........#...###.......###...#...#.....#...#.#.#.........###
#.#.#.#.###########.###################.#####.###.#.#.#########.#####.#.#.#.###.###########.#.#########.###########.#####.#.#.#.#########v###
#.#...#.............#...#...#.....#...#...###...#.#.#...........#...#...#...###.........#...#.#.......#.......#.....#...#.#.#.#...#.....>.###
#.###################.#.#.#.#.###.#.#.###.#####.#.#.#############.#.###################.#.###.#.#####.#######.#.#####.#.#.#.#.###.#.#####v###
#.#.....#...#...#.....#...#.#...#...#...#.....#.#.#...#...#.......#...#.....###...#...#.#...#.#.#...#.........#.....#.#.#.#.#.#...#.#.....###
#.#.###.#.#.#.#.#.#########.###.#######.#####.#.#.###.#.#.#.#########.#.###.###.#.#.#.#.###.#.#.#.#.###############.#.#.#.#.#.#.###.#.#######
#.#.#...#.#...#...#.........###.......#...#...#...###...#...#...#...#.#...#.....#...#...#...#.#...#.#.......#.......#.#.#.#...#...#.#.......#
#.#.#.###.#########.#################.###.#.#################.#.#.#.#.###.###############.###.#####.#.#####.#.#######.#.#.#######.#.#######.#
#.#.#...#.#.........#...#...#.........###...#...###...###.....#...#...#...#...........###...#.#.....#.#.....#.......#.#...###...#.#.#.......#
#.#.###.#.#.#########.#.#.#.#.###############.#.###.#.###.#############.###.#########.#####.#.#.#####.#.###########.#.#######.#.#.#.#.#######
#.#...#...#...........#...#.#.........#.....#.#.#...#.....###...#...###.....#...#.....#...#.#.#...#...#.#...#.....#.#.#.....#.#.#...#.......#
#.###.#####################.#########.#.###.#.#.#.###########.#.#.#.#########.#.#.#####.#.#.#.###.#.###.#.#.#.###.#.#.#.###.#.#.###########.#
#.....###...................#.........#...#...#.#.........#...#...#...#...#...#...#...#.#...#.###...###...#...#...#...#...#.#.#.###...#.....#
#########.###################.###########.#####.#########.#.#########.#.#.#.#######.#.#.#####.#################.#########.#.#.#.###.#.#.#####
#.....#...#...#.....#...#...#...#...#...#.....#.#...#...#.#.#...#.....#.#.#...###...#.#...#...#...#...#.........#...#.....#.#.#.#...#.#.....#
#.###.#.###.#.#.###.#.#.#.#.###.#.#.#.#.#####.#.#.#.#.#.#v#.#.#.#.#####.#.###.###.###.###.#.###.#.#.#.#v#########.#.#.#####.#.#.#.###.#####.#
#...#.#.....#...#...#.#.#.#.....#.#.#.#.#...#.#.#.#...#.>.>.#.#...#.....#.###...#...#...#.#...#.#.#.#.>.>...#...#.#.#.....#.#.#.#...#.###...#
###.#.###########v###.#.#.#######.#.#.#.#.#.#.#.#.#######v###.#####.#####.#####.###.###.#.###.#.#.#.###v###.#.#.#.#.#####.#.#.#.###.#.###v###
#...#...........#.>.#.#.#.......#.#.#.#.#.#...#.#.....#...###...###.....#.#.....###...#...#...#.#.#.###...#.#.#.#.#...#...#.#.#.#...#.#.>.###
#.#############.#v#.#.#.#######v#.#.#.#.#.#####.#####.#.#######.#######.#.#v#########.#####.###.#.#.#####.#.#.#.#.###.#.###.#.#.#.###.#.#v###
#.............#.#.#.#.#.#...#.>.>.#...#.#.###...#.....#.....###...#...#.#.>.>.#...#...#.....#...#.#.#.....#...#.#.#...#.#...#.#.#.###.#.#...#
#############.#.#.#.#.#.#.#.#.#v#######.#.###.###.#########.#####.#.#.#.###v#.#.#.#.###.#####.###.#.#.#########.#.#.###.#.###.#.#.###.#.###.#
###...#.....#.#...#.#.#.#.#.#.#.###.....#...#...#...#.......#.....#.#.#.#...#...#...###.....#...#...#.....#...#...#.#...#...#.#.#...#...#...#
###.#.#.###.#.#####.#.#.#.#.#.#.###.#######.###.###.#.#######.#####.#.#.#.#################.###.#########.#.#.#####.#.#####.#.#.###.#####.###
#...#...#...#.....#...#...#.#.#...#.........###.....#.......#.#...#.#.#.#.#...#####...#...#.....###...###...#.....#...#...#.#.#.#...###...###
#.#######.#######.#########.#.###.#########################.#.#.#.#.#.#.#.#.#.#####.#.#.#.#########.#.###########.#####.#.#.#.#.#.#####.#####
#.......#.#.....#.....#.....#...#...###.....#.....#.........#...#.#.#.#.#.#.#...###.#...#.....#.....#.............#.....#.#...#...#...#.....#
#######.#.#.###.#####.#.#######.###.###.###.#.###.#.#############.#.#.#.#.#.###.###.#########.#.###################.#####.#########.#.#####.#
#.......#.#...#.#...#.#.....#...###...#.#...#.#...#...........#...#.#...#...###.....#...#.....#.....#.....###.......#...#...#...#...#.......#
#.#######.###.#.#.#.#.#####.#.#######.#.#.###.#.#############.#.###.#################.#.#.#########.#.###.###.#######.#.###.#.#.#.###########
#.......#.....#...#...#.....#.#...#...#.#.....#...#...........#.....###...#...........#...#.....###...###...#.#.......#.....#.#.#...........#
#######.###############.#####.#.#.#.###.#########.#.###################.#.#.###############.###.###########.#.#.#############.#.###########.#
###...#...............#.#...#...#.#...#.#.........#.....................#.#.....#.........#...#.......#...#...#...#.........#.#.....#.......#
###.#.###############.#.#.#.#####.###.#.#.###############################.#####.#.#######.###.#######.#.#.#######.#.#######.#.#####.#.#######
#...#.................#...#...#...###...#.......#...#.................#...#...#.#.#.......#...#.......#.#.#.......#...#.....#.....#...#...###
#.###########################.#.###############.#.#.#.###############.#.###.#.#.#.#.#######.###.#######.#.#.#########.#.#########.#####.#.###
#.......................###...#.#.....#...#...#.#.#.#.......#...#...#...###.#.#...#.#.....#...#.#...#...#.#.......#...#...#.....#.......#...#
#######################.###.###.#.###.#.#.#.#.#.#.#.#######.#.#.#.#.#######.#.#####.#.###.###.#.#.#.#.###.#######.#.#####.#.###.###########.#
#.......................#...#...#...#...#...#.#...#.#.......#.#.#.#...#...#.#.#...#.#.#...###.#.#.#.#...#.###.....#.#.....#.#...#...#...#...#
#.#######################.###.#####.#########.#####.#.#######.#.#.###.#.#.#.#.#.#.#.#.#.#####.#.#.#.###.#.###v#####.#.#####.#.###.#.#.#.#v###
#...............#.....###.....#...#.........#.......#.......#.#.#...#...#.#.#.#.#.#...#.###...#.#.#.#...#...>.>.#...#...#...#.#...#.#.#.>.###
###############.#.###.#########.#.#########.###############.#.#.###.#####.#.#.#.#.#####.###.###.#.#.#.#######v#.#.#####.#.###.#.###.#.###v###
###...#...#.....#.#...#...#.....#.#.....#...###...###...#...#.#.###.#.....#.#.#.#.#...#.#...#...#.#.#...#.....#.#.#.....#...#...###...###...#
###.#.#.#.#.#####.#.###.#.#.#####.#.###.#.#####.#.###.#.#v###.#.###.#.#####.#.#.#.#.#.#v#.###.###.#.###.#.#####.#.#.#######.###############.#
#...#...#...#.....#...#.#...#.....#...#.#...#...#.#...#.>.>...#.#...#.#...#.#.#.#.#.#.>.>.###.....#.....#.....#.#.#.........#...#...#.....#.#
#.###########.#######.#.#####.#######.#.###.#.###.#.#####v#####.#.###.#.#.#.#.#.#.#.###v#####################.#.#.###########.#.#.#.#.###.#.#
#...#...#...#.#.......#.....#.#.....#.#.###...#...#...#...#...#...#...#.#...#.#.#.#...#.......###...#.....#...#.#.#.........#.#...#.#...#.#.#
###.#.#.#.#v#.#.###########.#.#.###.#.#.#######.#####.#.###.#.#####.###.#####.#.#.###.#######.###.#.#.###.#.###.#.#.#######.#.#####.###.#.#.#
#...#.#...#.>.#.#...###...#.#.#...#.#.#.###.....#.....#.....#.....#.....#...#.#.#.....#...#...#...#...###...###...#...#...#...#...#.#...#.#.#
#.###.#####v###.#.#.###.#.#.#.###.#.#.#.###v#####.###############.#######.#.#.#.#######.#.#.###.#####################.#.#.#####.#.#.#.###.#.#
#.....#...#.#...#.#...#.#.#.#.#...#.#.#...>.>...#...###...#...#...#.......#...#.###...#.#...###...................###...#.#.....#.#...###.#.#
#######.#.#.#.###.###.#.#.#.#.#.###.#.#####v###.###.###.#.#.#.#.###.###########.###.#.#.#########################.#######.#.#####.#######.#.#
#.......#...#.....###.#.#.#.#.#...#.#.#.....###.....#...#...#...###.......#...#.#...#...#...###...................#...###...#...#.......#.#.#
#.###################.#.#.#.#.###.#.#.#.#############.###################.#.#.#.#.#######.#.###.###################.#.#######.#.#######.#.#.#
#...........#...#...#.#.#...#.#...#...#.........#...#.........#...###...#...#...#...#.....#...#...........#.....#...#...#...#.#.....#...#.#.#
###########.#.#.#.#.#.#.#####.#.###############.#.#.#########.#.#.###.#.###########.#.#######.###########.#.###.#.#####.#.#.#.#####.#.###.#.#
#...........#.#...#.#.#...#...#...#...#.........#.#.#.......#.#.#.#...#.###.....###...#.....#.#...........#.#...#.....#...#.#.....#...###...#
#.###########.#####.#.###.#.#####.#.#.#.#########.#.#.#####.#.#.#.#.###.###.###.#######.###.#.#.###########.#.#######.#####.#####.###########
#.#.........#.###...#.....#.......#.#.#.......#...#...#...#...#.#.#...#.#...#...#.......###...#.#.....#.....#.#...###...#...#.....#.....#...#
#.#.#######.#.###.#################.#.#######.#.#######.#.#####.#.###.#.#.###.###.#############.#.###.#.#####.#.#.#####.#.###.#####.###.#.#.#
#.#.#.......#.#...#.....#...#.....#.#.###.....#...#.....#...###.#.#...#.#...#.###.........#...#.#.#...#.#.....#.#.#...#.#.###.....#...#.#.#.#
#.#.#.#######.#.###.###.#.#.#.###.#.#.###v#######.#.#######.###.#.#.###.###.#.###########.#.#.#.#.#.###.#.#####.#.#.#.#.#.#######.###.#.#.#.#
#...#.......#.#.....#...#.#.#...#...#...>.>.#...#...#.......#...#.#.#...#...#.#.....#.....#.#.#.#.#...#.#.#...#.#.#.#.#.#.#...#...#...#.#.#.#
###########.#.#######.###.#.###.#########v#.#.#.#####.#######.###.#.#.###.###.#.###.#.#####.#.#.#.###.#.#.#.#.#.#.#.#.#.#.#.#.#v###.###.#.#.#
#...###...#...###...#...#.#...#...###.....#.#.#...#...###...#...#.#.#.###...#.#...#.#...###.#.#...#...#.#.#.#.#.#.#.#.#.#.#.#.>.###...#.#.#.#
#.#.###.#.#######.#.###.#.###.###.###.#####.#.###.#.#####.#.###.#.#.#.#####.#.###.#.###v###.#.#####v###.#.#.#.#.#.#.#.#.#.#.###v#####.#.#.#.#
#.#.....#.........#...#.#...#.....#...#...#...#...#...#...#...#.#.#.#...#...#...#.#...>.>...#.#...>.>...#...#...#.#.#.#.#.#.#...###...#...#.#
#.###################.#.###.#######.###.#.#####.#####v#.#####.#.#.#.###.#.#####.#.#####v#####.#.###v#############.#.#.#.#.#.#.#####.#######.#
#.....#.....#.......#...###.......#.....#.....#...#.>.>.#####...#...#...#...#...#.#.....#.....#...#...###.......#...#...#.#.#.....#.#.......#
#####.#.###.#.#####.#############.###########.###.#.#v###############.#####.#.###.#.#####.#######.###.###.#####.#########.#.#####.#.#.#######
#...#...###.#.###...###...#.......#...........###.#.#.#...###...#...#.......#.#...#.....#.#.....#...#...#.#.....#.........#.#...#.#.#...#...#
#.#.#######.#.###v#####.#.#.#######.#############.#.#.#.#.###.#.#.#.#########.#.#######.#.#.###.###.###.#.#.#####.#########.#.#.#.#.###.#.#.#
#.#...#...#...###.>...#.#.#...#...#.........#.....#.#.#.#.....#...#.........#.#.#...#...#...###...#.#...#.#.....#.........#.#.#...#.#...#.#.#
#.###.#.#.#######v###.#.#.###.#.#.#########.#.#####.#.#.###################.#.#.#.#.#.###########.#.#.###.#####.#########.#.#.#####.#.###.#.#
#.#...#.#.#...###...#.#.#.#...#.#.....#...#.#...#...#...#...............#...#...#.#.#.....#...###...#...#.#.....#.....#...#.#.....#.#.....#.#
#.#.###.#.#.#.#####.#.#.#.#.###.#####.#.#.#.###.#.#######.#############.#.#######.#.#####.#.#.#########.#.#.#####.###.#.###.#####.#.#######.#
#.#.....#.#.#.#.....#...#.#.###.#...#...#...###...#...###.............#...#...#...#...#...#.#.#.....###...#...#...#...#...#.#...#.#.#.......#
#.#######.#.#.#.#########.#.###.#.#.###############.#.###############.#####.#.#.#####.#.###.#.#.###.#########.#.###.#####.#.#.#.#.#.#.#######
#...#...#.#.#.#.......###...###...#.......###...#...#.#.....###.......###...#.#.#...#.#.###.#...#...#...#...#...#...#####...#.#.#...#.....###
###.#.#.#.#.#.#######.###################.###.#.#.###.#.###.###.#########.###.#.#.#.#.#.###.#####.###.#.#.#.#####.###########.#.#########.###
#...#.#.#...#.......#.....#...............#...#...#...#...#.#...#...#...#.#...#...#.#...#...#.....#...#.#.#.......#...#...#...#...#.....#...#
#.###.#.###########.#####.#.###############.#######.#####.#.#.###.#.#.#.#.#.#######.#####.###.#####.###.#.#########.#.#.#.#.#####.#.###.###.#
#.#...#...........#.......#...............#.......#.....#.#.#.....#.#.#.#.#.#.....#.#...#.#...#...#...#.#.........#.#.#.#.#...#...#...#.....#
#.#.#############.#######################.#######.#####.#.#.#######.#.#.#.#.#.###.#.#.#.#.#.###.#.###.#.#########v#.#.#.#.###.#.#####.#######
#.#.#...........#...#.....#...............#.....#.#.....#.#.###.....#.#.#.#.#.#...#.#.#.#.#.#...#.#...#...#...#.>.>.#.#.#.#...#.....#.......#
#.#.#.#########.###.#.###.#.###############.###.#.#.#####.#.###v#####.#.#.#.#.#.###v#.#.#.#.#.###.#.#####.#.#.#.#####.#.#.#.#######.#######.#
#.#.#.........#.....#.#...#...............#...#.#.#.#.....#.#.>.>.#...#.#.#...#.#.>.>.#.#.#.#.#...#.#.....#.#.#.#####.#.#.#...#.....#.......#
#.#.#########.#######.#.#################.###.#.#.#.#.#####.#.###.#.###.#.#####.#.#####.#.#.#.#.###.#.#####.#.#.#####.#.#.###.#.#####.#######
#...#.........#.......#...#...###...###...#...#...#.#.....#.#.#...#...#.#.#.....#.#...#...#...#...#.#.....#.#...#.....#.#.....#...###.......#
#####.#########.#########.#.#.###.#.###.###.#######.#####.#.#.#.#####.#.#.#.#####.#.#.###########.#.#####.#.#####.#####.#########.#########.#
#.....#.........###.......#.#.....#.....###.......#...#...#.#.#...#...#...#.....#...#...#...###...#.....#.#.....#.....#.###...###...#...#...#
#.#####.###########.#######.#####################.###.#.###.#.###.#.###########.#######.#.#.###.#######.#.#####.#####.#.###.#.#####.#.#.#v###
#.......#.........#.#...###.............###...#...#...#...#...#...#.......#.....#.....#...#...#.....#...#.......#.....#...#.#.......#.#.>.###
#########.#######.#.#.#.###############v###.#.#.###.#####.#####.#########.#.#####.###.#######.#####.#.###########.#######.#.#########.###v###
#.......#...#...#...#.#...#.....#...#.>.>.#.#.#...#.#...#.....#...#...#...#...#...###.#...#...###...#.#...........#...#...#...#...#...#...###
#.#####.###.#.#.#####.###.#.###.#.#.#.###.#.#.###.#.#.#.#####.###.#.#.#.#####.#.#####.#.#.#.#####.###.#.###########.#.#.#####.#.#.#.###.#####
#.....#.....#.#.#...#.###.#...#.#.#.#.###.#.#.#...#.#.#...#...#...#.#.#.###...#.....#.#.#.#.....#.#...#.#.....#...#.#.#.#.....#.#.#.###.....#
#####.#######.#.#.#.#.###.###.#.#.#.#.###.#.#.#.###.#.###.#.###.###.#.#.###.#######.#.#.#.#####.#.#.###.#.###.#.#.#.#.#.#.#####.#.#.#######.#
#.....#.....#.#.#.#.#.#...#...#.#.#.#...#.#.#.#.#...#...#.#...#...#.#.#.#...#...#...#.#.#.#...#.#.#...#.#.#...#.#.#.#.#.#...#...#.#.#.......#
#.#####.###.#.#.#.#.#.#.###.###.#.#.###.#.#.#.#.#.#####.#.###.###.#.#.#.#.###.#.#.###.#.#.#.#.#.#.###.#.#.#.###.#.#.#.#.###.#.###.#.#.#######
#.......###...#...#...#.....###...#.....#...#...#.......#.....###...#...#.....#...###...#...#...#.....#...#.....#...#...###...###...#.......#
###########################################################################################################################################.#
`;

input = `
#.#####################
#.......#########...###
#######.#########.#.###
###.....#.>.>.###.#.###
###v#####.#v#.###.#.###
###.>...#.#.#.....#...#
###v###.#.#.#########.#
###...#.#.#.......#...#
#####.#.#.#######.#.###
#.....#.#.#.......#...#
#.#####.#.#.#########v#
#.#...#...#...###...>.#
#.#.#v#######v###.###v#
#...#.>.#...>.>.#.###.#
#####v#.#.###v#.#.###.#
#.....#...#...#.#.#...#
#.#########.###.#.#.###
#...###...#...#...#.###
###.###.#.###v#####v###
#...#...#.#.>.>.#.>.###
#.###.###.#.###.#.#v###
#.....###...###...#...#
#####################.#
`;

const board: string[][] = input
  .trim()
  .split("\n")
  .map((line) => line.split(""));

function inBounds(x: number, y: number): boolean {
  return 0 <= x && x < board[0].length && 0 <= y && y < board.length;
}

let output: HTMLElement | null = null;
function visualizePath(path) {
  if (output) output.remove();
  output = document.createElement("div");
  output.style.display = "flex";
  output.style.flexDirection = "column";

  for (let r = 0; r < board.length; r++) {
    const row = document.createElement("div");
    row.style.display = "flex";
    for (let c = 0; c < board[0].length; c++) {
      const cell = document.createElement("div");
      cell.style.width = "20px";
      cell.style.height = "20px";
      cell.style.border = "1px solid #333";
      cell.style.backgroundColor = board[r][c] === "#" ? "#333" : "white";
      if (path.has(`${r},${c}`)) {
        cell.style.backgroundColor = "crimson";
      }
      row.appendChild(cell);
    }
    output.appendChild(row);
  }
  document.body.appendChild(output);
}

const sleep = (ms: number) => new Promise((resolve) => setTimeout(resolve, ms));

type Direction = "^" | ">" | "v" | "<";

class PathNode {
  r: number;
  c: number;
  path: Set<string>;
  prevDirection: Direction | undefined;
  prevPositionKey: string | undefined;
  lastJunctionPositionKey: string | undefined;

  constructor(
    r: number,
    c: number,
    path: Set<string>,
    prevDirection: Direction | undefined,
    prevPositionKey: string | undefined,
    lastJunctionPositionKey: string | undefined
  ) {
    this.r = r;
    this.c = c;
    this.path = path;
    this.prevDirection = prevDirection;
    this.prevPositionKey = prevPositionKey;
    this.lastJunctionPositionKey = lastJunctionPositionKey;
  }

  get positionKey(): string {
    return `${this.r},${this.c}`;
  }
}

async function main() {
  const openList: PathNode[] = [
    new PathNode(0, 1, new Set<string>(), undefined, undefined, undefined),
  ];
  const visited = new Set<string>();
  let maxLen = 0;
  while (openList.length > 0) {
    const node: PathNode = openList.shift()!;
    const { r, c } = node;

    if (!inBounds(r, c)) {
      continue; // Out of bounds
    }

    if (board[r][c] === "#") {
      continue; // Wall
    }

    if (node.path.has(node.positionKey)) {
      continue; // Avoid loops
    }

    visualizePath(node.path);
    await sleep(200);

    if (r === board.length - 1) {
      console.log("Found path", node.path.size);
      maxLen = Math.max(maxLen, node.path.size);
      continue;
    }

    const newPath = new Set<string>(node.path);
    newPath.add(node.positionKey);

    const up = { r: r - 1, c: c };
    const down = { r: r + 1, c: c };
    const left = { r: r, c: c - 1 };
    const right = { r: r, c: c + 1 };
    const options = [up, down, left, right]
      .filter(
        // Avoid us going back the way we came
        (x) => `${x.r},${x.c}` !== node.prevPositionKey
      )
      .filter((x) => inBounds(x.r, x.c));
  }

  console.log(maxLen);
}
main();
