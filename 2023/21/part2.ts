let input = "";

input = `
...................................................................................................................................
...##......#....#...#.....#.#....#...#...#...#......#........................##......#..#..#.#........#....................##......
...#.......#..........#..#....#................#...##.....##...................#..........###......#.....#.........#....#.#........
........#..##.............#..#...##...#..#...##...............................#.........................#..........................
..............#............#..#..........#.#.#....#...#......................#..#......#.##...#............................#.......
..##...............#...#...#......#.......................................#..............##...............#.....#...........#...#..
.##............#.................#...#..#......#...................................#.......#.#..#......##................##........
......###...#...#........#..............#....#.......##.......................##.......#..#.......#.........#...................#..
.................#...........................................#......................#.....#.....##...........#...............#.....
..#...#....#.......##...........#..#.............#............................##........#.......#...#...#...#....#....##...........
..............#..#.....#.....#.........#..#..#..#..#.......#.#..#....##........#.....#.........#..............#........#..#...#....
...##...............#...#.#....#............##..#.......................................#.......#...........#..#...........##....#.
.......................................#......#...........#..........#.............#..........##.............#....#..##....#.......
..................................#.............#........#...#.##.....................#....................#.##....#.............#.
.#......##...#......#..#...#...........#...#.............#.............#..#.........#..#.#........#.#...........#..................
............#............#..........#........#..........#.....#.#...#.......#........#.#...........#....#.............#.........#..
.....#.......##............#...#.#.#...#...#..............##..#....#......#......................#...#...#..........#......#.#.....
........#....#....#......#..........#........................#.....#....................................#.....#....#..##.##....#...
............#.................#.##.........#.........#.....#........#.........#........#....###...........#.............#..........
....##....#..#............#...#.#..#.........................#.#....##.....................#........#.........#....#....#........#.
...#...#...........#..#..................#.......#.#..#............................................##................#.............
...........#......#....#........#.#..........................#.#......#......##.............#..#...#...#.#..................#..#...
.............................#........#............#........#........#.#.......#...............##....#........#...#..#..#..........
..................................#...........................#.#..#.........................#...#.#......#..............##.....##.
........................#..........................#..................#...#............................#.......#...........#...##..
.......#.#.....#....#.....#................................##...#.........##..#.....................#..............................
......#........##..........#.................#..##......#..#.......#..........#....................................................
....#..........#......................................................##.#..#.#.##..................#......#............##...#.....
.............#..........#.#..............................................#.#........#....#...........#.......................#.....
..#.............#....#........#.#..............#.......#......#.#..#......#.#...........................................##.........
..#.....#.....#....#...#....#..........#......#..............................#...........#............#..#.....##..........#.......
......#.#.#...#........................#..........#.#......#............#......................................#...................
.#...........#...#....................#..#..#....#.#........................................................................#.#....
........#.#...........................#...#......#.#.#..#......##..#.#..#..#...#.#.#..................#.......##.#....#........#...
......#......#......#.....#..............#.#.........##.................#....................#............#....##........#.........
........#.............#..#............#......#........#....#............#.....#...........#..#...............###........#.....#....
.....#.........##....#..................#..#...........#.#....##...........................#.............#..##..#.........#........
............#....#..#.................#.............#..#.....##.....#.....#.........#........#............#........#.........##....
.#.......#.#..........#...............#..............#.....#........#...#......#......##...........................#..#.#......##..
.##.#.........#.............................#............................#.#..#...#.............#...#.........#...#......#.........
................................#........#..#..........##......#..................................#................#.#...#...#.....
.........#........#...........#........................#.#.##.........#.....#..#................................#.............##...
.........#.#....#..#.........#.#....#.......#.............#........#............#...#..........#...##..........#........#........#.
..............................###.....#......#......#...#....#...........#...#...............#.....##.#.....................#..#...
..........................#......#...#..............................##.#.......#........##..........#................#...##.....#..
...........#............................#..................#...#..#.....................#...#.................................#....
..#.#...............................................#..........#..........#..............#............##...........................
........#...#..................#.........#............#...............#.#..#.........#....#...............#.............##.........
............................##....................##......#..#....#.......#....#........................#...#.........#.....#....#.
.....#.#...............#....#..#....#...........#........#.#..................#.....##....#.......#......#......................#..
...........#.........#.#.......#......#.#.#.......#.#...#...................#...#......#..............#...#....#.................#.
...#..#...........#.............#..........##..............................###...........#.#.....##.......#.............#..........
...##.....................##...#..#.....#.........#.#....#.#.....................#..............#.#...#...#......#..............#..
......##................#.................#.#........#.#..#................#............#......#.#..............#...............#..
.......#...........#.................................##..................#...#........#.......#..##...##...........#.........#.....
..............#........#.............#..........#...............#..#.......#.........#..#...............#......#..#.........##.#...
.....#..........................................#...............#....#......#..#................................#...............#..
...............#.......#..#.........#......#..................#........#................#.#...........#....##......#............#..
...........................#.....##.........#...#...........#........#..#................#.#.#............#..#...#.....#...........
................#.....#..#.#......#.............#.....#...........##....#...#.#.....#.........#....................................
....................................#...........#..............#................#............#..#...............#.##..#.##.........
.........#.#..............#........#.........#..#...#........#............##......##.......#....##.............#...................
..........##.....................#................#...#....#........#.....#..........#........#................#..###..............
......................#............................#........................#.#..#..........#......................................
........#...........#.#....#.........#.....#..........#..#.#..............#.......................#..#................#.#..........
.................................................................S.................................................................
.........#.....#..#..........#.....#...........#...............##..#...............#.##....#...........#........#.#....#....#......
.........##...#......#..#.#................#...........#..#...........#...#....#..............#......#..#.................##.......
.....................##.....................##...#.......#......#.............................#..#.................................
........................#..............#....#.................#....#...........#.................#...#.........#........#..........
.........#..#.#...#.#..................#..............#.#...###....#......#......#.#....#..##..............#............#..........
..#.......#...#..............#...#..##............#.........#......#.#....#.#..........................#......#..#.....#...........
..#........#......##.............................#..............#..#....................##.......#....#..#..#..........#...........
.....................#.....#...........#.##................#.#....#.#.#............#...#..##.............#.....##..................
..##............#........#........#...#......#..........##.................#...#.#..........#...................................##.
...#.............#....#...#..#........#.........#......#..................#..#..#..........#.....#........#.#....##............#...
...#.............#...............................#.......#....#..........#..........................##......##...#.............#...
....#................#..#.#................#.....#.......#..................#.......................#.#............................
....#.#..............#..#.........#..#..#................#..#...#.#..............#......#...................#......................
.#......#....................#.................#........##......#......##..........#...............#..##.#.....#.............#.....
...##................#..........#......##.....#........#...#..................#........#......#....#..#.....#......................
......#..................#......#.......#.......#..............#......#.........#.......#..#.#.#...##.....#.............#..........
.#...................#...#....#......#.#.....#.....#..................#.#......#.......#.....#..#......................#.....#.....
...#......................#.......#..#.........#............#...#......##..........#...............................................
...#..#........#........#...........#.#...#...#.#..#.#...#..................#........#........#.#.##...#...........#...............
........#.......................#.............#....#...##.........#....................................#..............#...#........
...#...........##........#..#.......#...............................#..................#.....#.......#.#.........#.................
..........#...............#.###...................#..................................#.....#...#................##...............#.
..#......#..........................#...........................#..................#..#........#....##...................##......#.
....#...........#..#..........................#......###................#...........................#.........#.#........#.#.......
...#...#..#........#...............#...........#.......#........................##..#...............#............#...........#.....
.....#..........................#..#........#.......#......#......#..........#..#.....#.....#..#.................#........#........
....#...##.......................#...#.....#.....................................##.#..#....#....#................#................
..#.....##.........#..............#.#................#.........#...#.................#.........#..............................#....
............#...........#........#........................#.#.......#..#..#.........##...................#......##.#.......#.......
.........#......#......#............#.....#...##...#...............................#.....#..............##............#..#.....##..
...........................#.................#...........#.........#....#.#.#....#......#..#....................#......#...........
....#.#..............................#......#..........#...........#....#.............#.#..............................#.....#..#..
...........#...........#.............##....#......#.........#................#........#...............................#............
...#........#.#....#.....................#..........#.......#...#.........#..........................##........#.#.#...##..........
....#.#....#.........#.......#....................#...........#..........#....#......................#.............#.....#..#....#.
..........#................................#......#....#......#.................................................#..................
.............#................................#...#.##.#.....#.......#....#............###.......#........##.......................
..........#......##.............#.........#............................#.#..#.......................................#.....#......#.
...#.....#.......#............#.............#.#...#.....#.............#..#..........##.......................#.....................
..........................#......#..................#..#........#............#.......##......................###.......#.....#.....
............#.#....#.#................................##......#..............#..#.#........................#......#...#...#........
......##..........#......###...#......................#.........#.#............#..............#......#..............#.......#......
............#........#.....#........#..#.......#...#...................#.....#..................##.............#.................#.
........#.#........##..................................#......#......................................#.....................#.#...#.
.#.......##......#.....#..........#................#...................##..#...............#.......##....................#.........
...#..#..#.............................#...................#................#....................................#........#........
.....#....................................#.........##.............#...........................#...................................
............................#....#......#...................#..................................#...........................##......
...............#...#..#...#.###.#...........#..............#..........#...............##........#.##.#....#.#.............##.....#.
...........#.##......#...#.#.........#.#.#...#.........................................#..........#.............#.#.............#..
........#...............#........#........................#.#......#......#......................#...........#.........#.#...#.....
....#..#.............#......................#...................#.....##...............#...#........#.................#............
............#......#...#.....#..........#....#...............##.....##..#.........#....#..#.......#...#..#.........................
......#...........#.......#...#.#.....#...#......#...........#......#................#................#....#.#...#.................
.......#.#...#.......#......#.................................#..............................#...........#.............#.........#.
...................................#.....#.........#.............................#..#............#...................#...#.........
...............#......#...........................#................#...............##...........#......#........#....##......#.#...
...............#....................##....#...#.....#.................................#..#.............#.#..#.....#..#.#...........
.............................#......##..#........................................##....#.................#......#....#...#.........
......#.#.#...............#.......#............................................................#................#..........#..#....
...#.#...........#..#......#....###...............#..#..#......................#....#..............#......#................#.......
.......................#....#.....#..#.##.#..........#.....................#..................................#....####.##.........
......#..........##...#...........................#....#.................#........#.......................#.................#..#...
.................#..#...................#..#...#...##...#..................#..........#.#....#..#...........................#....#.
...................................................................................................................................
`;

// input = `
// ...........
// .....###.#.
// .###.##..#.
// ..#.#...#..
// ....#.#....
// .##..S####.
// .##..#...#.
// .......##..
// .##.#.####.
// .##..##.##.
// ...........
// `;

input = `
........................
.####..............####.
.###................###.
.##..................##.
.#....................#.
...........#............
..........###...........
.........#####..........
..........###...........
...........#............
........................
........................
.#....................#.
.##..................##.
.###................###.
.####..............####.
........................
`;

const lines = input.trim().split("\n");
const board = lines.map((line) => line.split(""));

let output: HTMLElement | null = null;
function visualize(nodes: Position[]) {
  const body = document.body;
  const startRows = -board.length;
  const startCols = -board[0].length;
  const endRows = board.length * 2;
  const endCols = board[0].length * 2;

  const getCell = (r: number, c: number) =>
    board.at(r % board.length)?.at(c % board[0].length);

  const getOutputCell = (r: number, c: number) => {
    // `r` could be a negative number so we need to add the length
    return output!.children[r + board.length].children[
      c + board[0].length
    ] as HTMLDivElement;
  };

  const getColor = (r: number, c: number) => {
    const boardWidth = board[0].length;
    const boardHeight = board.length;
    const nomalizedR =
      r >= 0 ? r % boardHeight : (r % boardHeight) + boardHeight;
    const nomalizedC = c >= 0 ? c % boardWidth : (c % boardWidth) + boardWidth;
    if (
      0 <= nomalizedR &&
      nomalizedR < boardHeight / 2 &&
      0 <= nomalizedC &&
      nomalizedC < boardWidth / 2
    )
      return "lightgreen"; // top left
    if (
      0 <= nomalizedR &&
      nomalizedR < boardHeight / 2 &&
      boardWidth / 2 <= nomalizedC &&
      nomalizedC < boardWidth
    )
      return "gold"; // top right

    if (
      boardHeight / 2 <= nomalizedR &&
      nomalizedR < boardHeight &&
      0 <= nomalizedC &&
      nomalizedC < boardWidth / 2
    )
      return "skyblue"; // bottom left

    if (
      boardHeight / 2 <= nomalizedR &&
      nomalizedR < boardHeight &&
      boardWidth / 2 <= nomalizedC &&
      nomalizedC < boardWidth
    )
      return "coral"; // bottom right

    console.log("r", r);
    console.log("c", c);
    console.log("nomalizedR", nomalizedR);
    console.log("nomalizedC", nomalizedC);

    return "red";
  };

  if (!output) {
    output = document.createElement("div");
    output.style.flexDirection = "column";
    // Initialize
    for (let r = startRows; r < endRows; r++) {
      const rowEl = document.createElement("div");
      for (let c = startCols; c < endCols; c++) {
        const cellEl = document.createElement("div");
        cellEl.style.width = "20px";
        cellEl.style.height = "20px";
        cellEl.style.backgroundColor = "#ebf4ff";
        cellEl.setAttribute("data-r", String(r));
        cellEl.setAttribute("data-c", String(c));
        const cell = getCell(r, c);
        if (cell === "#") cellEl.style.backgroundColor = "#333";
        rowEl.appendChild(cellEl);
      }
      output.appendChild(rowEl);
    }
    body.appendChild(output);
  }

  // Reset
  for (let r = startRows; r < endRows; r++) {
    for (let c = startCols; c < endCols; c++) {
      const cellEl = getOutputCell(r, c);
      const cell = getCell(r, c);
      if (cell !== "#" && cellEl.style.backgroundColor !== getColor(r, c))
        cellEl.style.backgroundColor = getColor(r, c);
    }
  }

  // console.log("nodes", nodes);
  // Update the nodes to be red
  for (const node of nodes) {
    const cellEl = getOutputCell(node.r, node.c);
    cellEl.style.backgroundColor = "crimson";
  }
}

class Position {
  r: number;
  c: number;
  constructor(r: number, c: number) {
    this.r = r;
    this.c = c;
  }

  get char() {
    return board.at(this.r)?.at(this.c);
  }

  toString() {
    return `${this.r},${this.c}`;
  }
}

const positionCache = new Map<string, Position>();
const position = (r: number, c: number) => {
  const key = `${r},${c}`;
  if (positionCache.has(key)) return positionCache.get(key)!;
  const pos = new Position(r, c);
  positionCache.set(key, pos);
  return pos;
};

const startPosition = board
  .flatMap((row, r) => row.map((cell, c) => position(r, c)))
  .filter((pos) => pos.char === "S")[0];

const cache = new Map<string, Position[]>();
const positions = (node: Position) => {
  if (cache.has(String(node))) return cache.get(String(node))!;
  const options = [
    position(node.r - 1, node.c),
    position(node.r + 1, node.c),
    position(node.r, node.c - 1),
    position(node.r, node.c + 1),
  ].filter((pos) => pos.char === "." || pos.char === "S");
  cache.set(String(node), options);
  return options;
};

const sleep = (ms: number) => new Promise((resolve) => setTimeout(resolve, ms));

const main = async (nodes: Set<Position>, iterations: number) => {
  for (let i = 0; i < iterations; i++) {
    const nextNodes: Position[] = [];

    console.log("i", i, "nodes", nodes.size);

    visualize([...nodes]);
    await sleep(100);

    for (const node of nodes) {
      nextNodes.push(...positions(node));
    }

    nodes = new Set(nextNodes);
  }
  return nodes;
};
sleep(10).then(async () => {
  const ret = await main(new Set([startPosition]), 4);
  visualize([...ret]);
});
